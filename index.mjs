function e(t){"@babel/helpers - typeof";return e=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},e(t)}function t(t,n){if(e(t)!=`object`||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var i=r.call(t,n||`default`);if(e(i)!=`object`)return i;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(n===`string`?String:Number)(t)}function n(n){var r=t(n,`string`);return e(r)==`symbol`?r:r+``}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=function(e){return e[e.Resize=0]=`Resize`,e[e.Scroll=1]=`Scroll`,e}(i||{}),a=function(e){return e[e.Down=0]=`Down`,e[e.None=1]=`None`,e[e.Up=2]=`Up`,e}(a||{}),o=function(e){return e[e.Both=0]=`Both`,e[e.None=1]=`None`,e[e.Top=2]=`Top`,e}(o||{}),s=function(e){return e[e.ContainerBottom=0]=`ContainerBottom`,e[e.ColliderTop=1]=`ColliderTop`,e[e.ColliderBottom=2]=`ColliderBottom`,e[e.None=3]=`None`,e[e.TranslateY=4]=`TranslateY`,e[e.Rest=5]=`Rest`,e}(s||{}),c=class{constructor(e,t,n){r(this,`container`,void 0),r(this,`containerInner`,void 0),r(this,`events`,void 0),r(this,`isRunningRequest`,void 0),r(this,`translateY`,void 0),r(this,`maxTranslateY`,void 0),r(this,`prevElementHeight`,void 0),r(this,`containerHeight`,void 0),r(this,`containerWidth`,void 0),r(this,`containerLeft`,void 0),r(this,`containerTop`,void 0),r(this,`prevContainerWidth`,void 0),r(this,`prevContainerLeft`,void 0),r(this,`prevContainerTop`,void 0),r(this,`colliderHeight`,void 0),r(this,`colliderTop`,void 0),r(this,`prevColliderTop`,void 0),r(this,`prevViewportScrollX`,void 0),r(this,`prevViewportScrollY`,void 0),r(this,`spaceTop`,void 0),r(this,`prevSpaceTop`,void 0),r(this,`spaceBottom`,void 0),r(this,`prevSpaceBottom`,void 0),r(this,`resizeObserver`,void 0),r(this,`strategy`,void 0),r(this,`prevStrategy`,void 0),r(this,`prevState`,void 0),r(this,`listOfRules`,void 0),r(this,`rules`,void 0),this.container=e,this.containerInner=t,this.prevSpaceBottom=n?.spaceBottom??0,this.prevSpaceTop=n?.spaceTop??0,this.spaceBottom=n?.spaceBottom??0,this.spaceTop=n?.spaceTop??0,this.listOfRules={width:`initial`,left:`initial`,top:`initial`,position:n?.position??`initial`,transform:`initial`},this.colliderHeight=0,this.colliderTop=0,this.containerHeight=0,this.containerLeft=0,this.containerTop=0,this.containerWidth=0,this.events=[!1,!1],this.isRunningRequest=!1,this.maxTranslateY=0,this.prevColliderTop=0,this.prevContainerLeft=0,this.prevContainerTop=0,this.prevContainerWidth=0,this.prevElementHeight=0,this.prevState=s.None,this.prevStrategy=o.None,this.prevViewportScrollX=0,this.prevViewportScrollY=0,this.rules={},this.strategy=o.None,this.translateY=0,this._calcDims=this._calcDims.bind(this),this._calcScroll=this._calcScroll.bind(this),this._resizeListener=this._resizeListener.bind(this),this._scrollListener=this._scrollListener.bind(this),this.resizeObserver=new ResizeObserver(this._resizeListener)}enable(){this._addListeners()}disable(){this._removeListeners(),this._init(),this._render(s.None)}updateSpaces(e){this.spaceBottom=e.spaceBottom??0,this.spaceTop=e.spaceTop??0,this._init(),this._resizeListener()}_init(){this.colliderHeight=0,this.colliderTop=0,this.containerHeight=0,this.containerLeft=0,this.containerTop=0,this.containerWidth=0,this.events=[!1,!1],this.isRunningRequest=!1,this.maxTranslateY=0,this.prevColliderTop=0,this.prevContainerLeft=0,this.prevContainerTop=0,this.prevContainerWidth=0,this.prevElementHeight=0,this.prevState=s.None,this.prevStrategy=o.None,this.prevViewportScrollX=0,this.prevViewportScrollY=0,this.rules={},this.strategy=o.None,this.translateY=0}_resizeListener(){this.events[i.Resize]===!1&&(this.events[i.Resize]=!0),this._request()}_scrollListener(){this.events[i.Scroll]===!1&&(this.events[i.Scroll]=!0),this._request()}_getCoords(e){let t={left:e.offsetLeft,top:e.offsetTop};for(;e=e.tagName===`BODY`?e.parentElement:e.offsetParent;)t.top+=e.offsetTop,t.left+=e.offsetLeft;return t}_render(e){e===s.ContainerBottom?(this.translateY=this.maxTranslateY,this.rules={top:this.spaceTop+`px`,left:`0px`,position:`sticky`,width:this.container.clientWidth+`px`}):e===s.ColliderBottom?(this.translateY=0,this.rules={top:this.colliderHeight+this.spaceTop-this.containerInner.offsetHeight+`px`,left:this.containerLeft-window.scrollX+`px`,position:`fixed`,width:this.container.clientWidth+`px`}):e===s.ColliderTop?(this.translateY=0,this.rules={top:this.spaceTop+`px`,left:this.containerLeft-window.scrollX+`px`,position:`fixed`,width:this.container.clientWidth+`px`}):e===s.None?(this.translateY=0,this.rules={}):e===s.TranslateY&&(this.prevState===s.ColliderTop?this.translateY=this.prevColliderTop-this.containerTop:this.prevState===s.ColliderBottom?this.translateY=this.prevColliderTop+this.colliderHeight-this.containerTop-this.prevElementHeight:this.prevState===s.ContainerBottom&&(this.translateY=this.containerHeight-this.containerInner.offsetHeight),this.rules={position:`relative`,transform:`translate3d(0px, ${this.translateY}px, 0px)`}),this.container.style.position=e===s.ContainerBottom?`relative`:`initial`;for(let e in this.listOfRules)this.containerInner.style[e]=this.rules[e]??this.listOfRules[e]}_getDirection(){return this.prevViewportScrollY===window.scrollY?a.None:this.prevViewportScrollY<window.scrollY?a.Down:a.Up}_getState(e){if(this.prevState===s.ColliderTop){if(this.colliderTop<=this.containerTop)return s.None;if(this.colliderTop+this.containerInner.offsetHeight>=this.containerTop+this.containerHeight)return s.ContainerBottom;if(this.prevStrategy===o.Top&&this.containerInner.offsetHeight>this.colliderHeight)return this.prevStrategy=this.strategy,s.TranslateY;if(this.strategy===o.Both&&e===a.Down)return s.TranslateY;if(this.prevViewportScrollX!==window.scrollX||this.prevContainerLeft!==this.containerLeft||this.prevContainerWidth!==this.containerWidth||this.prevContainerTop!==this.containerTop||this.prevSpaceBottom!==this.spaceBottom||this.prevSpaceTop!==this.spaceTop)return s.ColliderTop}else if(this.prevState===s.ColliderBottom){if(this.colliderTop<=this.containerTop)return s.None;if(this.colliderTop+this.colliderHeight>=this.containerTop+this.containerHeight)return s.ContainerBottom;if(this.containerInner.offsetHeight<=this.colliderHeight)return s.ColliderTop;if(e===a.Up||this.prevElementHeight!==this.containerInner.offsetHeight)return s.TranslateY;if(this.prevViewportScrollX!==window.scrollX||this.prevContainerLeft!==this.containerLeft||this.prevContainerWidth!==this.containerWidth||this.prevContainerTop!==this.containerTop||this.prevSpaceBottom!==this.spaceBottom||this.prevSpaceTop!==this.spaceTop)return s.ColliderBottom}else if(this.prevState===s.ContainerBottom){if(this.colliderTop<=this.containerTop)return s.None;if(e===a.Up&&this.colliderTop<=this.containerTop+this.maxTranslateY||this.containerInner.offsetHeight<this.containerTop+this.containerHeight-this.colliderTop)return s.ColliderTop;if(this.prevContainerWidth!==this.containerWidth)return s.ContainerBottom}else if(this.prevState===s.None){if(this.colliderTop+this.containerInner.offsetHeight>=this.containerTop+this.containerHeight)return s.ContainerBottom;if(this.containerInner.offsetHeight<this.colliderHeight&&this.colliderTop>=this.containerTop)return s.ColliderTop;if(this.strategy===o.Both&&this.colliderTop+this.colliderHeight>=this.containerTop+this.containerInner.offsetHeight)return s.ColliderBottom}else if(this.prevState===s.TranslateY){if(this.containerHeight-this.translateY<this.containerInner.offsetHeight)return s.ContainerBottom;if(this.containerInner.offsetHeight<this.colliderHeight||this.colliderTop<=this.containerTop+this.translateY)return s.ColliderTop;if(this.translateY<this.maxTranslateY&&this.colliderTop+this.colliderHeight>this.containerTop+this.translateY+this.containerInner.offsetHeight)return s.ColliderBottom}return s.Rest}_getStrategy(){return this.containerHeight<=this.containerInner.offsetHeight?o.None:this.colliderHeight<this.containerInner.offsetHeight?o.Both:o.Top}_calcDims(){let e=this._getCoords(this.container);this.containerLeft=e.left,this.containerTop=e.top,this.containerHeight=this.container.clientHeight,this.containerWidth=this.container.clientWidth,this.colliderHeight=window.innerHeight-this.spaceTop-this.spaceBottom,this.maxTranslateY=this.container.clientHeight-this.containerInner.offsetHeight,this.strategy=this._getStrategy(),this.strategy===o.None?this.prevStrategy!==this.strategy&&this._render(s.None):this._calcScroll(),this.prevContainerWidth=this.containerWidth,this.prevContainerLeft=this.containerLeft,this.prevContainerTop=this.containerTop,this.prevElementHeight=this.containerInner.offsetHeight,this.prevStrategy=this.strategy,this.prevSpaceBottom=this.spaceBottom,this.prevSpaceTop=this.spaceTop}_calcScroll(){this.colliderTop=window.scrollY+this.spaceTop;let e=this._getState(this._getDirection());e!==s.Rest&&(this._render(e),this.prevState=e),this.prevColliderTop=this.colliderTop,this.prevViewportScrollX=window.scrollX,this.prevViewportScrollY=window.scrollY}_request(){this.isRunningRequest||(this.isRunningRequest=!0,window.requestAnimationFrame(()=>{this.events[i.Resize]?(this.events[i.Resize]=!1,this._calcDims()):this.events[i.Scroll]&&(this.events[i.Scroll]=!1,this._calcScroll()),this.isRunningRequest=!1}))}_observeTreeNodesFromCurrentToBody(e){for(;e&&(this.resizeObserver.observe(e),e.tagName!==`BODY`);)e=e.parentElement}_addListeners(){window.addEventListener(`scroll`,this._scrollListener,{capture:!1,passive:!0}),this._observeTreeNodesFromCurrentToBody(this.containerInner)}_removeListeners(){window.removeEventListener(`scroll`,this._scrollListener,{capture:!1}),this.resizeObserver.disconnect()}};export{c as StickNRoll,c as default};
//# sourceMappingURL=index.mjs.map