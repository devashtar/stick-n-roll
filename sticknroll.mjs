var r=class{container;element;events;isRunningRequest;translateY;maxTranslateY;prevElementHeight;containerHeight;containerWidth;containerLeft;containerTop;prevContainerWidth;prevContainerLeft;prevContainerTop;colliderHeight;prevColliderHeight;colliderTop;prevColliderTop;prevViewportScrollX;prevViewportScrollY;spaceTop;spaceBottom;resizeObserver;strategy;prevStrategy;prevState;listOfRules;rules;constructor(t,e,i){this.container=t,this.element=e,this.isRunningRequest=!1,this.colliderHeight=0,this.prevColliderHeight=0,this.colliderTop=0,this.prevColliderTop=0,this.containerHeight=0,this.containerWidth=0,this.containerLeft=0,this.containerTop=0,this.prevContainerWidth=0,this.prevContainerLeft=0,this.prevContainerTop=0,this.prevElementHeight=0,this.maxTranslateY=0,this.translateY=0,this.prevViewportScrollX=0,this.prevViewportScrollY=0,this.events=[0,0],this.strategy=1,this.prevStrategy=1,this.prevState=3,this.listOfRules={width:"",left:"",top:"",position:i?.position??"",transform:""},this.rules={},this.spaceBottom=i?.spaceBottom??0,this.spaceTop=i?.spaceTop??0,this._calcDims=this._calcDims.bind(this),this._calcScroll=this._calcScroll.bind(this),this._resizeListener=this._resizeListener.bind(this),this._scrollListener=this._scrollListener.bind(this),this.resizeObserver=new ResizeObserver(this._resizeListener)}enable(){this._addListeners()}disable(){this._removeListeners(),this.isRunningRequest=!1,this.events.fill(0)}updateSpaces(t){this.spaceBottom=t.spaceBottom??0,this.spaceTop=t.spaceTop??0,this._resizeListener()}_resizeListener(){this.events[0]===0&&(this.events[0]=1),this._request()}_scrollListener(){this.events[1]===0&&(this.events[1]=2),this._request()}_getCoords(t){let e={left:t.offsetLeft,top:t.offsetTop};for(;t=t.tagName==="BODY"?t.parentElement:t.offsetParent;)e.top+=t.offsetTop,e.left+=t.offsetLeft;return e}_render(t){t===0?(this.translateY=this.maxTranslateY,this.rules={top:this.spaceTop+"px",left:"0px",position:"sticky",width:this.container.clientWidth+"px"}):t===2?(this.translateY=0,this.rules={top:this.colliderHeight+this.spaceTop-this.element.offsetHeight+"px",left:this.containerLeft-window.scrollX+"px",position:"fixed",width:this.container.clientWidth+"px"}):t===1?(this.translateY=0,this.rules={top:this.spaceTop+"px",left:this.containerLeft-window.scrollX+"px",position:"fixed",width:this.container.clientWidth+"px"}):t===3?(this.translateY=0,this.rules={}):t===4&&(this.prevState===1?this.translateY=this.prevColliderTop-this.containerTop:this.prevState===2?this.translateY=this.prevColliderTop+this.colliderHeight-this.containerTop-this.prevElementHeight:this.prevState===0&&(this.translateY=this.containerHeight-this.element.offsetHeight),this.rules={position:"relative",transform:`translate3d(0px, ${this.translateY}px, 0px)`}),this.container.style.position=t===0?"relative":"";for(let e in this.listOfRules)this.element.style[e]=this.rules[e]??this.listOfRules[e]}_getDirection(){return this.prevViewportScrollY===window.scrollY?1:this.prevViewportScrollY<window.scrollY?0:2}_getState(t){if(this.prevState===1){if(this.colliderTop<=this.containerTop)return 3;if(this.colliderTop+this.element.offsetHeight>=this.containerTop+this.containerHeight)return 0;if(this.prevStrategy===2&&this.element.offsetHeight>this.colliderHeight)return this.prevStrategy=this.strategy,4;if(this.strategy===0&&t===0)return 4;if(this.prevViewportScrollX!==window.scrollX||this.prevContainerLeft!==this.containerLeft||this.prevContainerWidth!==this.containerWidth||this.prevContainerTop!==this.containerTop||this.prevColliderHeight!==this.colliderHeight||this.prevColliderTop!==this.colliderTop)return 1}else if(this.prevState===2){if(this.colliderTop<=this.containerTop)return 3;if(this.colliderTop+this.colliderHeight>=this.containerTop+this.containerHeight)return 0;if(this.element.offsetHeight<=this.colliderHeight)return 1;if(t===2||this.prevElementHeight!==this.element.offsetHeight)return 4;if(this.prevViewportScrollX!==window.scrollX||this.prevContainerLeft!==this.containerLeft||this.prevContainerWidth!==this.containerWidth||this.prevContainerTop!==this.containerTop||this.prevColliderHeight!==this.colliderHeight||this.prevColliderTop!==this.colliderTop)return 2}else if(this.prevState===0){if(this.colliderTop<=this.containerTop)return 3;if(t===2&&this.colliderTop<=this.containerTop+this.maxTranslateY||this.element.offsetHeight<this.containerTop+this.containerHeight-this.colliderTop)return 1;if(this.prevContainerWidth!==this.containerWidth)return 0}else if(this.prevState===3){if(this.colliderTop+this.element.offsetHeight>=this.containerTop+this.containerHeight)return 0;if(this.element.offsetHeight<this.colliderHeight&&this.colliderTop>=this.containerTop)return 1;if(this.strategy===0&&this.colliderTop+this.colliderHeight>=this.containerTop+this.element.offsetHeight)return 2}else if(this.prevState===4){if(this.containerHeight-this.translateY<this.element.offsetHeight)return 0;if(this.element.offsetHeight<this.colliderHeight||this.colliderTop<=this.containerTop+this.translateY)return 1;if(this.translateY<this.maxTranslateY&&this.colliderTop+this.colliderHeight>this.containerTop+this.translateY+this.element.offsetHeight)return 2}return 5}_getStrategy(){return this.containerHeight<=this.element.offsetHeight?1:this.colliderHeight<this.element.offsetHeight?0:2}_calcDims(){let t=this._getCoords(this.container);this.containerLeft=t.left,this.containerTop=t.top,this.containerHeight=this.container.clientHeight,this.containerWidth=this.container.clientWidth,this.colliderHeight=window.innerHeight-this.spaceTop-this.spaceBottom,this.maxTranslateY=this.container.clientHeight-this.element.offsetHeight,this.strategy=this._getStrategy(),this.strategy===1?this.prevStrategy!==this.strategy&&this._render(3):this._calcScroll(),this.prevContainerWidth=this.containerWidth,this.prevContainerLeft=this.containerLeft,this.prevContainerTop=this.containerTop,this.prevElementHeight=this.element.offsetHeight,this.prevStrategy=this.strategy}_calcScroll(){this.colliderTop=window.scrollY+this.spaceTop;let t=this._getState(this._getDirection());t!==5&&(this._render(t),this.prevState=t),this.prevColliderTop=this.colliderTop,this.prevViewportScrollX=window.scrollX,this.prevViewportScrollY=window.scrollY}_request(){this.isRunningRequest||(this.isRunningRequest=!0,window.requestAnimationFrame(()=>{this.events[0]===1?(this.events[0]=0,this._calcDims()):this.events[1]===2&&(this.events[1]=0,this._calcScroll()),this.isRunningRequest=!1}))}_observeTreeNodesFromCurrentToBody(t){for(;t&&(this.resizeObserver.observe(t),t.tagName!=="BODY");)t=t.parentElement}_addListeners(){window.addEventListener("scroll",this._scrollListener,{capture:!1,passive:!0}),this._observeTreeNodesFromCurrentToBody(this.element)}_removeListeners(){window.removeEventListener("scroll",this._scrollListener,{capture:!1}),this.resizeObserver.disconnect()}},o=r;export{r as StickNRoll,o as default};
/**
 * Stick-N-Roll.
 * Helps to give an element sticky scrolling capability.
 * @version 1.0.4
 * @author devashtar <omg.michael.here@gmail.com>
 * @license The MIT License (MIT)
 */
